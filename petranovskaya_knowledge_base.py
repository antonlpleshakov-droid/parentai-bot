"""
Knowledge base based on Петрановская "Тайная опора" (The Secret Support)
This is the only source of parenting advice for the bot.
"""

PETRANOVSKAYA_KNOWLEDGE = {
    "attachment_theory": {
        "description": "Основы теории привязанности по Петрановской",
        "key_principles": [
            "Привязанность - это не просто любовь, а биологическая потребность ребенка",
            "Ребенок рождается с потребностью в привязанности, как с потребностью в еде и сне",
            "Привязанность формируется в первые годы жизни и влияет на всю дальнейшую жизнь",
            "Безопасная привязанность дает ребенку уверенность в мире и в себе"
        ],
        "age_0_3_months": [
            "В этот период формируется базовая привязанность",
            "Ребенок должен чувствовать, что его потребности удовлетворяются",
            "Важно быстро реагировать на плач и сигналы ребенка",
            "Контакт кожа к коже очень важен для формирования привязанности"
        ],
        "age_3_6_months": [
            "Ребенок начинает различать близких людей",
            "Появляется страх незнакомцев - это нормально",
            "Важно поддерживать постоянство в уходе",
            "Ребенок учится доверять миру через доверие к маме"
        ],
        "age_6_12_months": [
            "Ребенок активно исследует мир, но всегда возвращается к маме",
            "Мама - это 'база безопасности' для исследования",
            "Важно не ограничивать исследовательскую активность",
            "Ребенок проверяет привязанность - это нормально"
        ],
        "age_1_3_years": [
            "Кризис 2-3 лет - это проверка границ привязанности",
            "Ребенок учится быть отдельной личностью, но остается привязанным",
            "Важно устанавливать границы с любовью",
            "Истерики - это способ проверить, любит ли мама его даже в плохом поведении"
        ]
    },
    
    "crying_and_comfort": {
        "petranovskaya_approach": [
            "Плач - это способ общения ребенка, а не манипуляция. Ребенок плачет, потому что ему плохо, а не чтобы досадить родителям",
            "Нельзя 'избаловать' ребенка, удовлетворяя его потребности. Игнорирование плача разрушает привязанность"
        ],
        "what_to_do": [
            "Немедленно подойдите к ребенку и возьмите на руки",
            "Проверьте физические потребности: голод, холод, мокрый подгузник, неудобная одежда",
            "Если физических причин нет, просто будьте рядом - ваше присутствие успокаивает",
            "Говорите ласково: 'Я здесь, мама рядом, все будет хорошо'",
            "Для детей старше 1 года: 'Я вижу, что тебе грустно. Расскажи, что случилось?'",
            "Обнимайте, носите на руках, пойте колыбельные",
            "Не оставляйте ребенка плакать одного - это разрушает доверие"
        ],
        "age_0_3_months": [
            "В этом возрасте плач - единственный способ общения",
            "Реагируйте на каждый плач - это формирует базовое доверие к миру",
            "Контакт кожа к коже очень важен для успокоения"
        ],
        "age_3_6_months": [
            "Ребенок начинает различать близких людей",
            "Ваше лицо и голос - главные успокоители",
            "Показывайте, что понимаете его чувства"
        ],
        "age_6_12_months": [
            "Ребенок может плакать от страха разлуки",
            "Объясняйте, что вы рядом: 'Мама здесь, не бойся'",
            "Используйте переходные объекты (игрушка, одеяло)"
        ],
        "age_1_3_years": [
            "Ребенок может плакать от фрустрации - не может выразить словами",
            "Помогите назвать чувства: 'Ты злишься, потому что...'",
            "Предлагайте альтернативы: 'Вместо этого давай...'"
        ],
        "common_mistakes": [
            "Игнорирование плача 'чтобы не избаловать'",
            "Попытки отучить от рук",
            "Оставление ребенка плакать 'для закалки характера'",
            "Сравнение с другими детьми"
        ]
    },
    
    "sleep_issues": {
        "petranovskaya_approach": [
            "Сон - это продолжение привязанности",
            "Ребенок должен чувствовать себя в безопасности, чтобы заснуть",
            "Нельзя 'научить' спать через игнорирование",
            "Совместный сон может быть полезен для формирования привязанности"
        ],
        "sleep_tips": [
            "Создайте ритуал перед сном",
            "Ребенок должен засыпать в спокойном состоянии",
            "Если ребенок просыпается ночью, успокойте его",
            "Не оставляйте плакать в кроватке",
            "Доверяйте интуиции в вопросах сна"
        ]
    },
    
    "discipline_and_boundaries": {
        "petranovskaya_approach": [
            "Границы нужны, но они должны быть с любовью",
            "Ребенок проверяет границы, чтобы убедиться в прочности привязанности",
            "Наказание должно быть справедливым и понятным",
            "Никогда не наказывайте отказом в любви"
        ],
        "setting_boundaries": [
            "Говорите 'нет' спокойно и уверенно",
            "Объясняйте, почему что-то нельзя",
            "Предлагайте альтернативы",
            "Будьте последовательны, но гибки",
            "Помните: ребенок не плохой, плохое только его поведение"
        ],
        "tantrums": [
            "Истерика - это способ проверить любовь родителей",
            "Не поддавайтесь на истерику, но и не игнорируйте ребенка",
            "Оставайтесь рядом, но не меняйте решение",
            "После истерики обнимите ребенка",
            "Истерики проходят, когда ребенок понимает, что границы тверды"
        ]
    },
    
    "development_milestones": {
        "petranovskaya_approach": [
            "Каждый ребенок развивается в своем темпе",
            "Не сравнивайте с другими детьми",
            "Доверяйте ребенку - он знает, что ему нужно",
            "Поддерживайте, но не подталкивайте"
        ],
        "motor_skills": [
            "Не сажайте ребенка, пока он сам не сядет",
            "Не ставьте на ноги, пока не поползет",
            "Ребенок сам выберет время для каждого этапа",
            "Поддерживайте, но не форсируйте развитие"
        ],
        "speech_development": [
            "Говорите с ребенком с самого рождения",
            "Читайте книги, пойте песни",
            "Не исправляйте речь навязчиво",
            "Доверяйте - ребенок заговорит, когда будет готов"
        ]
    },
    
    "parenting_philosophy": {
        "core_beliefs": [
            "Ребенок - это личность, а не проект для воспитания",
            "Любовь и принятие - основа всего",
            "Доверие к ребенку и к себе",
            "Гибкость важнее строгих правил",
            "Каждая семья уникальна"
        ],
        "common_mistakes": [
            "Попытки 'воспитать' через наказания",
            "Сравнение с другими детьми",
            "Игнорирование потребностей ребенка",
            "Жесткие правила без учета индивидуальности",
            "Фокус на поведении, а не на отношениях"
        ],
        "success_principles": [
            "Безопасная привязанность - основа всего",
            "Ребенок должен чувствовать себя любимым безусловно",
            "Границы с любовью, а не из страха",
            "Доверие к интуиции родителей",
            "Фокус на отношениях, а не на поведении"
        ]
    }
}

def get_petranovskaya_advice(topic, age_group=None):
    """Get advice based on Петрановская's book only."""
    if topic in PETRANOVSKAYA_KNOWLEDGE:
        advice = PETRANOVSKAYA_KNOWLEDGE[topic]
        
        if age_group and age_group in advice:
            return advice[age_group]
        elif "petranovskaya_approach" in advice:
            return advice["petranovskaya_approach"]
        elif "key_principles" in advice:
            return advice["key_principles"]
        else:
            return list(advice.values())[0] if advice else []
    
    return []

def get_all_petranovskaya_topics():
    """Get all available topics from Петрановская's knowledge base."""
    return list(PETRANOVSKAYA_KNOWLEDGE.keys())

def format_petranovskaya_response(topic, age_group=None):
    """Format response based on Петрановская's principles with structured format."""
    advice = get_petranovskaya_advice(topic, age_group)
    
    if not advice:
        return "К сожалению, в книге Петрановской 'Тайная опора' нет информации по этому вопросу. Я специализируюсь на вопросах развития, воспитания, здоровья детей и родительства. Чем еще могу помочь?"
    
    # Create structured response
    response = f"Согласно книге Людмилы Петрановской 'Тайная опора':\n\n"
    
    # Short summary
    if len(advice) > 0:
        response += f"**Краткий ответ:** {advice[0]}\n\n"
    
    # Structured detailed response
    response += "**Что делать пошагово:**\n"
    for i, item in enumerate(advice[1:], 1):
        response += f"{i}. {item}\n"
    
    # Sources
    response += f"\n**Источники:** Книга 'Тайная опора' Людмилы Петрановской\n"
    
    # Conversation continuation
    response += f"\nМогу ли я помочь вам с чем-то еще по этой теме?"
    
    return response
